{% extends 'base.html' %}

{% block content %}
<div class="row g-4">
  <div class="col-md-3">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="text-muted">Total Routers</div>
        <div class="display-6">{{ summary.total }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="text-muted">Online</div>
        <div class="display-6 text-success">{{ summary.online }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="text-muted">Degraded</div>
        <div class="display-6 text-warning">{{ summary.degraded }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="text-muted">Anomalies (24h)</div>
        <div class="display-6 text-danger">{{ summary.anomalies }}</div>
      </div>
    </div>
  </div>
</div>

<div class="row g-4 mt-1">
  <div class="col-lg-8">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Anomalies & Participation (Per Router)</h5>
        <canvas id="lineChart" height="120"></canvas>
      </div>
    </div>
  </div>
  <div class="col-lg-4">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Top Devices (24h)</h5>
        <ul class="list-group list-group-flush">
          {% for d in devices %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            {{ d.id }}
            <span class="badge bg-danger rounded-pill">{{ d.anomalies_24h }}</span>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  const chartData = {{ chart_data | tojson }};
  const ctx = document.getElementById('lineChart');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: chartData.labels,
      datasets: [
        {
          label: 'Anomalies',
          data: chartData.anomalies,
          borderColor: '#dc3545',
          backgroundColor: 'rgba(220,53,69,0.1)',
          tension: 0.3
        },
        {
          label: 'Client Participation %',
          data: chartData.participation,
          borderColor: '#0d6efd',
          backgroundColor: 'rgba(13,110,253,0.1)',
          tension: 0.3
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'bottom' }
      }
    }
  });
</script>
{% endblock %}
